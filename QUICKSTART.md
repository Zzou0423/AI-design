# 🚀 AI问卷助手 - 快速开始指南

> 一个基于大语言模型的智能问卷生成与分析系统
> 
> **适用人群**: 研究人员、市场调研人员、产品经理、数据分析师

---

## 📋 目录

1. [系统简介](#系统简介)
2. [核心功能](#核心功能)
3. [环境要求](#环境要求)
4. [快速安装](#快速安装)
5. [配置说明](#配置说明)
6. [启动系统](#启动系统)
7. [使用教程](#使用教程)
8. [脚本工具](#脚本工具)
9. [常见问题](#常见问题)
10. [进阶使用](#进阶使用)

---

## 🎯 系统简介

**AI问卷助手**是一个集成了问卷生成、回答收集、智能分析于一体的完整解决方案。

### 核心优势

✅ **智能生成** - 输入简短需求，AI自动生成专业问卷  
✅ **RAG增强** - 基于优质案例库，生成更贴近实际的问题  
✅ **多维分析** - 支持定性分析和全量分析两种模式  
✅ **数据可视化** - 自动生成词云、图表等可视化内容  
✅ **批量测试** - AI模拟用户批量生成测试数据

---

## 🌟 核心功能

### 1. 智能问卷生成

**特点**:
- 需求理解增强（将简短描述扩写为详细背景）
- RAG案例检索（从知识库中找到相似问卷作为参考）
- 多种题型支持（单选、多选、量表、开放题）

**使用场景**: 
- 市场调研问卷
- 用户体验调查
- 满意度评估
- 学术研究调查

### 2. 问卷填写与收集

**特点**:
- 响应式设计，支持PC和移动端
- 实时保存答案
- 支持匿名填写
- 数据自动存储

### 3. 智能分析引擎

#### 3.1 开放题分析（定性分析）
- 📝 主题自动编码
- 💭 情感倾向识别
- 📌 代表性引述提取
- 📊 词云 + 主题分布图 + 情感饼图

#### 3.2 全量分析（量化+质化）
- 📈 量表题分布统计
- 📊 选择题占比分析
- 🔍 交叉洞察发现
- 🎯 战略建议生成
- 📊 每个问题对应可视化图表

### 4. 批量答案生成（测试工具）

**特点**:
- 智能身份生成（基于问卷主题）
- 答案倾向控制（积极/消极/中性/混合/随机）
- 并发批量生成（支持多线程）
- 统计报告输出

---

## 💻 环境要求

### 必需软件

| 软件 | 版本要求 | 说明 |
|------|---------|------|
| **Python** | 3.9+ | 推荐3.10或3.11 |
| **pip** | 最新版 | Python包管理器 |
| **Git** | 任意版本 | 用于克隆项目（可选） |

### 操作系统

- ✅ Windows 10/11
- ✅ macOS 10.15+
- ✅ Linux (Ubuntu 20.04+)

### 硬件建议

- **CPU**: 2核心以上
- **内存**: 4GB以上（推荐8GB）
- **硬盘**: 至少2GB可用空间
- **网络**: 稳定的互联网连接（调用LLM API）

---

## 📦 快速安装

### 步骤1: 获取项目代码

**方式A: 使用Git克隆**
```bash
git clone https://github.com/your-repo/ai_survey_assistant.git
cd ai_survey_assistant
```

**方式B: 直接下载ZIP**
1. 下载项目ZIP压缩包
2. 解压到目标目录
3. 进入项目文件夹

### 步骤2: 创建虚拟环境（推荐）

**Windows**:
```powershell
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
.\venv\Scripts\activate
```

**macOS/Linux**:
```bash
# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate
```

### 步骤3: 安装依赖

```bash
pip install -r requirements.txt
```

**安装时间**: 约2-5分钟（取决于网速）

**预期输出**:
```
Successfully installed:
- fastapi
- uvicorn
- langchain
- dashscope
- chromadb
- matplotlib
- wordcloud
- pillow
... (共约50个包)
```

---

## ⚙️ 配置说明

### 1. 配置API密钥

#### 获取DashScope API Key

1. 访问 [阿里云百炼平台](https://dashscope.console.aliyun.com/)
2. 注册/登录账号
3. 进入控制台 → API-KEY 管理
4. 创建新的API Key并复制

#### 设置环境变量

**方式A: 创建.env文件（推荐）**

在项目根目录创建 `.env` 文件：
```bash
# .env
DASHSCOPE_API_KEY=your_api_key_here
```

**方式B: 设置系统环境变量**

**Windows**:
```powershell
setx DASHSCOPE_API_KEY "your_api_key_here"
```

**macOS/Linux**:
```bash
export DASHSCOPE_API_KEY="your_api_key_here"
# 添加到 ~/.bashrc 或 ~/.zshrc 使其永久生效
```

### 2. 初始化向量数据库（可选）

如果需要使用RAG功能，将优质问卷案例PDF放入 `data/` 目录，系统会自动导入到向量库。

---

## 🎮 启动系统

### 方式1: 使用启动脚本（推荐）

**Windows**:
```batch
start.bat
```

**macOS/Linux**:
```bash
chmod +x start.sh
./start.sh
```

### 方式2: 手动启动

```bash
# 确保已激活虚拟环境
python run_all.py
```

### 启动成功标志

看到以下输出表示启动成功：
```
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

### 访问系统

在浏览器中打开：**http://localhost:8000**

---

## 📖 使用教程

### 🎯 场景1: 生成问卷

#### 1. 访问首页

打开浏览器，访问 `http://localhost:8000`

#### 2. 登录/注册

- 首次使用：点击"注册"创建账号
- 已有账号：输入用户名和密码登录

#### 3. 输入需求

在文本框中输入您的问卷需求，例如：
```
我想了解用户对我们新上线的手机APP的使用体验，
包括界面设计、功能实用性、操作流畅度等方面。
```

#### 4. 生成问卷

点击"生成问卷"，等待10-20秒，系统会：
- 从知识库检索相似案例
- 基于需求和案例生成问卷
- 返回包含多种题型的专业问卷

#### 5. 预览与编辑

生成后可以预览和编辑问卷内容，点击"保存"确认。

#### 6. 分享问卷

- **预览**: 查看完整问卷内容
- **填写**: 点击"去填写"进入填写页面
- **分享**: 复制问卷链接分享给受访者

---

### 📝 场景2: 填写问卷

#### 1. 访问问卷链接

通过分享的链接访问问卷，例如：
```
http://localhost:8000/survey/detail/abc123
```

#### 2. 填写答案

- 单选题：选择一个选项
- 多选题：选择一个或多个选项
- 量表题：拖动滑块选择分数
- 开放题：输入文字回答

#### 3. 提交问卷

填写完成后点击"提交问卷"，系统会自动保存数据。

---

### 📊 场景3: 分析结果

#### 1. 进入工作空间

登录后点击"我的问卷"，选择要分析的问卷。

#### 2. 选择分析类型

**开放题分析（定性分析）**:
- 适用场景：只关注开放题的文本回答
- 输出内容：主题编码 + 情感分析 + 可视化
- 分析时间：30-60秒

**全量分析（综合分析）**:
- 适用场景：需要全面了解所有问题的结果
- 输出内容：量化统计 + 质化分析 + 战略建议 + 完整可视化
- 分析时间：60-120秒

#### 3. 查看报告

分析完成后，页面显示：

**开放题分析报告包含**:
```
📊 数据可视化
├─ 🔠 主题词云
├─ 📊 主题提及频次分布
└─ 📈 主题情感分布

📄 定性分析报告
├─ 总体摘要
├─ 核心主题（含代表性引述）
└─ 行动建议
```

**全量分析报告包含**:
```
📊 数据可视化
├─ 🔠 整体主题词云
├─ 每个问题的图表（5-10个）
│   ├─ 量表题分布图
│   ├─ 选择题分布图
│   └─ 开放题词云+主题图

📄 战略诊断报告
├─ 核心摘要
├─ 关键发现（3-5条）
├─ 交叉洞察
├─ 关键少数派分析
├─ 风险与机会
└─ 战略建议（3-5条）
```

#### 4. 导出报告

点击"下载PDF报告"按钮，在打印对话框中选择"另存为PDF"即可保存完整报告。

---

## 🛠️ 脚本工具

### 1. 启动脚本 (`start.bat` / `start.sh`)

**功能**: 一键启动系统

**使用方法**:
```batch
# Windows
start.bat

# macOS/Linux
./start.sh
```

**说明**:
- 自动激活虚拟环境
- 检查依赖是否完整
- 启动FastAPI服务器
- 打开默认浏览器

---

### 2. 批量答案生成器 (`generate_responses.py`)

**功能**: AI模拟用户批量生成问卷答案（用于测试）

**使用场景**:
- 快速生成测试数据
- 验证分析功能准确性
- 压力测试系统性能

**启动方式**:
```bash
python generate_responses.py
```

**交互流程**:

```
============================================================
AI问卷答案批量生成器
============================================================

可用问卷列表:
[1] 在线问卷平台用户体验调研 (10个问题)
[2] 博美犬饲养习惯与偏好调查 (8个问题)
[3] 国产动漫观众偏好与观感调查 (12个问题)

请选择要生成答案的问卷编号: 1

请输入要生成的答案数量 (默认50): 100

请选择答案倾向模式:
[1] 积极倾向 - 生成正面评价为主的答案
[2] 消极倾向 - 生成负面评价为主的答案
[3] 中性倾向 - 生成中立客观的答案
[4] 混合倾向 - 包含各种倾向的混合答案
[5] 随机倾向 - 随机分配倾向（推荐用于测试）

请输入选择 (1-5, 默认4): 5

请输入并发线程数 (1-10, 默认5): 8

开始生成...
进度: [████████████████████] 100/100 (100%)
预计剩余时间: 0分0秒

============================================================
生成完成!
============================================================

生成统计:
- 总数量: 100份
- 成功: 100份
- 失败: 0份
- 耗时: 2分34秒
- 平均速度: 0.65份/秒

倾向分布:
- 积极: 32份 (32.0%)
- 中性: 36份 (36.0%)
- 消极: 32份 (32.0%)

预期分析结果:
问卷回答倾向分布均衡，分析报告应该能够识别出不同用户群体
的差异化需求和痛点。
```

**高级选项**:

```bash
# 查看帮助
python generate_responses.py --help

# 非交互模式（适合脚本自动化）
python generate_responses.py --survey-id abc123 --count 50 --tendency mixed --workers 5
```

**参数说明**:

| 参数 | 说明 | 示例 |
|------|------|------|
| `--survey-id` | 问卷ID | `abc123` |
| `--count` | 生成数量 | `50` |
| `--tendency` | 倾向模式 | `positive`, `negative`, `neutral`, `mixed`, `random` |
| `--workers` | 并发线程数 | `5` |

**性能指标**:

- **单线程**: 约0.3-0.5份/秒
- **5线程**: 约1.5-2.5份/秒
- **10线程**: 约2.5-4份/秒

**注意事项**:

⚠️ 生成大量答案会消耗API额度，请合理使用  
⚠️ 并发数不宜过高（建议≤10），避免触发API限流  
⚠️ 生成的答案质量取决于LLM模型能力

---

## ❓ 常见问题

### Q1: 启动失败，提示"模块未找到"

**原因**: 依赖未正确安装

**解决**:
```bash
# 确保激活虚拟环境
.\venv\Scripts\activate  # Windows
source venv/bin/activate  # macOS/Linux

# 重新安装依赖
pip install -r requirements.txt
```

---

### Q2: 生成问卷失败，提示API错误

**原因**: API Key未配置或无效

**解决**:
1. 检查 `.env` 文件中的 `DASHSCOPE_API_KEY` 是否正确
2. 访问阿里云控制台验证API Key是否有效
3. 确保账户有足够的API调用额度

---

### Q3: 分析结果没有可视化图表

**原因**: 可视化库未安装在虚拟环境中

**解决**:
```bash
# 在虚拟环境中安装可视化库
.\venv\Scripts\python.exe -m pip install matplotlib wordcloud pillow
```

---

### Q4: 批量生成答案很慢

**原因**: 并发数设置过低或网络较慢

**优化方案**:
- 增加并发线程数（5-10线程）
- 检查网络连接
- 减少单次生成数量，分批执行

---

### Q5: 全量分析报告内容不完整

**原因**: LLM输出token限制

**当前解决方案**:
- 系统已增加max_tokens到8000
- 优化了提示词结构
- 添加了完整性检查和警告提示
- 支持PDF导出完整报告

---

### Q6: 端口8000被占用

**解决**:

**Windows**:
```powershell
# 查找占用进程
netstat -ano | findstr :8000

# 结束进程（替换PID为实际进程ID）
taskkill /PID <PID> /F
```

**macOS/Linux**:
```bash
# 查找占用进程
lsof -i :8000

# 结束进程
kill -9 <PID>
```

或修改 `run_all.py` 中的端口号。

---

## 🚀 进阶使用

### 1. 自定义LLM模型

编辑配置文件，切换不同的通义千问模型：

```python
# app/services/survey_service.py
LLM_MODEL = "qwen-plus"  # 默认
# LLM_MODEL = "qwen-turbo"  # 更快，成本更低
# LLM_MODEL = "qwen-max"  # 更强，成本更高
```

### 2. 扩展问卷案例库

将优质问卷PDF放入 `data/` 目录，系统会自动：
- 解析PDF内容
- 向量化存储到ChromaDB
- 用于RAG检索

### 3. 调整分析参数

```python
# app/services/full_analysis_service.py
# 修改温度参数（0-1，越高越随机）
temperature = 0.3  # 分析严谨
# temperature = 0.7  # 分析灵活

# 修改最大输出长度
max_tokens = 8000  # 默认
# max_tokens = 12000  # 更长的报告
```

### 4. 部署到生产环境

```bash
# 使用Gunicorn（生产级WSGI服务器）
pip install gunicorn

# 启动4个工作进程
gunicorn -w 4 -k uvicorn.workers.UvicornWorker run_all:app --bind 0.0.0.0:8000
```

### 5. 数据备份

```bash
# 备份用户数据和问卷
tar -czf backup_$(date +%Y%m%d).tar.gz data/surveys data/responses data/users.json

# 恢复备份
tar -xzf backup_20250101.tar.gz
```

---

## 📚 更多资源

### 文档目录

- **完整文档**: `README.md`
- **项目结构**: `docs/PROJECT_STRUCTURE.md`
- **可视化指南**: `docs/VISUALIZATION_ENHANCEMENT.md`
- **性能优化**: `docs/PERFORMANCE_OPTIMIZATION.md`
- **问题修复**: `docs/REPORT_COMPLETENESS_FIX.md`

### 技术栈

- **后端**: Python + FastAPI
- **AI框架**: LangChain + DashScope
- **向量库**: ChromaDB
- **可视化**: matplotlib + wordcloud
- **前端**: HTML + CSS + JavaScript

### 联系与支持

- **Issue反馈**: [GitHub Issues]
- **功能建议**: [GitHub Discussions]
- **技术交流**: [社区论坛]

---

## ✅ 快速检查清单

在开始使用前，请确保：

- [ ] Python 3.9+ 已安装
- [ ] 虚拟环境已创建并激活
- [ ] 依赖包已全部安装 (`pip install -r requirements.txt`)
- [ ] API Key 已正确配置 (`.env` 文件)
- [ ] 可视化库已安装在venv中
- [ ] 系统能正常启动 (`start.bat` 或 `python run_all.py`)
- [ ] 能访问 http://localhost:8000
- [ ] 能成功登录/注册
- [ ] 能生成问卷
- [ ] 能填写问卷
- [ ] 能进行分析并看到可视化图表

全部完成？恭喜您，开始使用AI问卷助手吧！🎉

---

## 📝 更新日志

### v1.0.0 (2025-10-30)

✨ **新功能**:
- 智能问卷生成（RAG增强）
- 开放题定性分析
- 全量综合分析
- 数据可视化（5种图表）
- 批量答案生成器

🐛 **修复**:
- 修复报告完整性问题
- 修复可视化库环境问题
- 优化提示词结构

📖 **文档**:
- 添加快速开始指南
- 完善项目结构文档
- 新增故障排查指南

---

**祝您使用愉快！如有问题，欢迎反馈。** 🚀

