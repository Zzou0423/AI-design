# é—®å·åˆ†æåŠŸèƒ½ - å®Œæ•´æ¶æ„ä¸æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
5. [ç®—æ³•æŠ€æœ¯](#ç®—æ³•æŠ€æœ¯)
6. [APIæ¥å£](#apiæ¥å£)
7. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
8. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)

---

## åŠŸèƒ½æ¦‚è¿°

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
å½“å‰ç³»ç»Ÿå®ç°äº†**åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„å¼€æ”¾é¢˜å®šæ€§åˆ†æ**åŠŸèƒ½ï¼Œä¸“æ³¨äºä»ç”¨æˆ·çš„è‡ªç”±æ–‡æœ¬å›ç­”ä¸­æå–ç»“æ„åŒ–çš„æ´å¯Ÿã€‚

### âœ¨ ä¸»è¦èƒ½åŠ›
- **ä¸»é¢˜è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·åé¦ˆä¸­çš„æ ¸å¿ƒä¸»é¢˜
- **æƒ…æ„Ÿåˆ†æ**ï¼šåˆ¤æ–­æ¯ä¸ªä¸»é¢˜çš„æƒ…æ„Ÿå€¾å‘ï¼ˆç§¯æ/æ¶ˆæ/ä¸­æ€§ï¼‰
- **å¼•è¿°æå–**ï¼šæå–æœ€å…·ä»£è¡¨æ€§çš„ç”¨æˆ·åŸè¯
- **é¢‘æ¬¡ä¼°ç®—**ï¼šä¼°ç®—å„ä¸»é¢˜è¢«æåŠçš„ç›¸å¯¹é¢‘ç‡
- **è¡ŒåŠ¨å»ºè®®**ï¼šåŸºäºåˆ†æç»“æœç”Ÿæˆå¯æ“ä½œçš„å»ºè®®

### ğŸ“ åˆ†ææ–¹æ³•è®º
é‡‡ç”¨**è´¨æ€§ç ”ç©¶ï¼ˆQualitative Researchï¼‰**æ–¹æ³•è®ºï¼š
- **ä¸»é¢˜ç¼–ç ï¼ˆThematic Codingï¼‰**ï¼šè¯†åˆ«å¹¶å½’çº³æ•°æ®ä¸­çš„ä¸»é¢˜
- **å†…å®¹åˆ†æï¼ˆContent Analysisï¼‰**ï¼šç³»ç»ŸåŒ–åœ°åˆ†ææ–‡æœ¬å†…å®¹
- **æƒ…æ„Ÿåˆ†æï¼ˆSentiment Analysisï¼‰**ï¼šåˆ¤æ–­æƒ…æ„Ÿå€¾å‘

---

## ç³»ç»Ÿæ¶æ„

### ğŸ“ ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯å±•ç¤ºå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  é—®å·è¯¦æƒ…é¡µ   â”‚  â”‚  åˆ†æé¡µé¢    â”‚  â”‚  æŠ¥å‘Šå±•ç¤º    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP/JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APIæ¥å£å±‚                               â”‚
â”‚  POST /api/analyze/{survey_id}                              â”‚
â”‚  â†“                                                           â”‚
â”‚  FastAPIè·¯ç”± â†’ run_all.py#analyze_survey_results()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚                                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚       SurveyAnalysisEngine                    â”‚         â”‚
â”‚  â”‚       (åˆ†æå¼•æ“ - ç¼–æ’è€…)                      â”‚         â”‚
â”‚  â”‚                                                â”‚         â”‚
â”‚  â”‚  1. æ•°æ®åŠ è½½  _load_data()                     â”‚         â”‚
â”‚  â”‚  2. æ•°æ®æå–  _extract_open_ended_responses() â”‚         â”‚
â”‚  â”‚  3. æ‰§è¡Œåˆ†æ  qualitative_analyzer.analyze()  â”‚         â”‚
â”‚  â”‚  4. ç”ŸæˆæŠ¥å‘Š  generate_report()                â”‚         â”‚
â”‚  â”‚  5. è¿”å›ç»“æœ                                   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚       QualitativeAnalyzer                      â”‚         â”‚
â”‚  â”‚       (å®šæ€§åˆ†æå™¨ - æ‰§è¡Œè€…)                     â”‚         â”‚
â”‚  â”‚                                                 â”‚         â”‚
â”‚  â”‚  â€¢ æ•°æ®é¢„å¤„ç†  _preprocess_responses()         â”‚         â”‚
â”‚  â”‚  â€¢ LLMåˆ†æ    _perform_qualitative_analysis()  â”‚         â”‚
â”‚  â”‚  â€¢ ç»“æœéªŒè¯   Pydanticæ¨¡å‹éªŒè¯                  â”‚         â”‚
â”‚  â”‚  â€¢ æŠ¥å‘Šç”Ÿæˆ   generate_report()                â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚           AnalysisToolkit                      â”‚         â”‚
â”‚  â”‚           (åˆ†æå·¥å…·åŒ… - å¤‡ç”¨)                   â”‚         â”‚
â”‚  â”‚                                                 â”‚         â”‚
â”‚  â”‚  â€¢ ç”¨æˆ·èšç±»   tool_cluster_users()             â”‚         â”‚
â”‚  â”‚  â€¢ ä¸»é¢˜æå–   tool_extract_themes()            â”‚         â”‚
â”‚  â”‚  â€¢ æƒ…æ„Ÿåˆ†æ   tool_analyze_sentiment()         â”‚         â”‚
â”‚  â”‚  â€¢ å…³é”®è¯æå– tool_extract_keywords()          â”‚         â”‚
â”‚  â”‚  â€¢ ç»Ÿè®¡æ‘˜è¦   tool_statistics_summary()        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®è®¿é—®å±‚                                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ JSONæ–‡ä»¶è¯»å†™  â”‚  â”‚ Pydanticæ¨¡å‹ â”‚  â”‚ æ•°æ®éªŒè¯     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨æœåŠ¡å±‚                                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚           DashScope LLM API                  â”‚          â”‚
â”‚  â”‚           (é˜¿é‡Œäº‘é€šä¹‰åƒé—®)                    â”‚          â”‚
â”‚  â”‚                                               â”‚          â”‚
â”‚  â”‚  â€¢ æ¨¡å‹ï¼šqwen-plus                            â”‚          â”‚
â”‚  â”‚  â€¢ Temperature: 0.7                          â”‚          â”‚
â”‚  â”‚  â€¢ è¾“å…¥ï¼šç”¨æˆ·åé¦ˆæ–‡æœ¬ + Prompt                â”‚          â”‚
â”‚  â”‚  â€¢ è¾“å‡ºï¼šç»“æ„åŒ–JSONåˆ†æç»“æœ                   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ è®¾è®¡æ¨¡å¼

1. **åˆ†å±‚æ¶æ„æ¨¡å¼**ï¼šèŒè´£æ¸…æ™°åˆ†ç¦»
   - å±•ç¤ºå±‚ï¼šå‰ç«¯UI
   - æ¥å£å±‚ï¼šAPIè·¯ç”±
   - ä¸šåŠ¡å±‚ï¼šåˆ†æé€»è¾‘
   - æ•°æ®å±‚ï¼šæ–‡ä»¶å­˜å‚¨

2. **ç­–ç•¥æ¨¡å¼**ï¼šå¯æ‰©å±•çš„åˆ†æç­–ç•¥
   - å½“å‰ï¼šLLMé©±åŠ¨çš„å®šæ€§åˆ†æ
   - æœªæ¥ï¼šå¯æ·»åŠ å…¶ä»–åˆ†æç­–ç•¥

3. **ç¼–æ’æ¨¡å¼**ï¼š
   - `SurveyAnalysisEngine`ä½œä¸ºç¼–æ’è€…
   - åè°ƒæ•°æ®åŠ è½½ã€åˆ†æã€æŠ¥å‘Šç”Ÿæˆ

---

## æ ¸å¿ƒç»„ä»¶

### 1. SurveyAnalysisEngineï¼ˆåˆ†æå¼•æ“ï¼‰

**ä½ç½®**ï¼š`app/services/analysis_engine.py`

**èŒè´£**ï¼šç»Ÿä¸€çš„åˆ†æå…¥å£å’Œæµç¨‹ç¼–æ’

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```python
def analyze(survey_id: str) -> Dict[str, Any]:
    """
    å®Œæ•´çš„åˆ†ææµç¨‹ï¼š
    1. åŠ è½½é—®å·å’Œå›ç­”æ•°æ®
    2. æå–å¼€æ”¾é¢˜å›ç­”
    3. æ‰§è¡Œå®šæ€§åˆ†æ
    4. ç”ŸæˆMarkdownæŠ¥å‘Š
    5. è¿”å›ç»“æ„åŒ–ç»“æœ
    """
```

**æ•°æ®åŠ è½½**ï¼š
```python
def _load_data(survey_id: str) -> Tuple[Dict, List[Dict]]:
    """
    - ä» data/surveys/ åŠ è½½é—®å·æ¨¡æ¿
    - ä» data/responses/{survey_title}_{survey_id}/ åŠ è½½æ‰€æœ‰å›ç­”
    - æ”¯æŒå¤šç§æ–‡ä»¶åæ ¼å¼
    """
```

**æ•°æ®æå–**ï¼š
```python
def _extract_open_ended_responses(survey, responses) -> List[str]:
    """
    - è¯†åˆ«é—®å·ä¸­æ‰€æœ‰"å¼€æ”¾å¼é—®é¢˜"ç±»å‹çš„é¢˜ç›®
    - ä»æ‰€æœ‰å›ç­”ä¸­æå–è¿™äº›é—®é¢˜çš„ç­”æ¡ˆ
    - å¤„ç†å¤šç§ç­”æ¡ˆæ ¼å¼ï¼ˆå­—å…¸/å­—ç¬¦ä¸²ï¼‰
    - è¿”å›çº¯æ–‡æœ¬åˆ—è¡¨
    """
```

**è¾“å‡ºæ ¼å¼**ï¼š
```json
{
  "survey_id": "83f37184",
  "survey_title": "åšç¾çŠ¬é¥²å…»ä¹ æƒ¯ä¸åå¥½è°ƒæŸ¥é—®å·",
  "total_responses": 102,
  "open_ended_responses_count": 510,
  "analysis_type": "å®šæ€§åˆ†æ",
  "status": "success",
  "report": {
    "summary": "æ€»ä½“æ‘˜è¦...",
    "themes": [...],
    "recommendation": "è¡ŒåŠ¨å»ºè®®..."
  },
  "formatted_report": "# Markdownæ ¼å¼æŠ¥å‘Š..."
}
```

### 2. QualitativeAnalyzerï¼ˆå®šæ€§åˆ†æå™¨ï¼‰

**ä½ç½®**ï¼š`app/services/qualitative_analyzer.py`

**èŒè´£**ï¼šæ‰§è¡Œæ ¸å¿ƒçš„å®šæ€§åˆ†æé€»è¾‘

**åˆå§‹åŒ–**ï¼š
```python
def __init__(llm_model="qwen-plus", temperature=0.7):
    """
    - åˆå§‹åŒ–DashScope LLMå®¢æˆ·ç«¯
    - é…ç½®æ¨¡å‹å‚æ•°
    """
    self.llm_client = ChatDashScope(
        model=llm_model,
        temperature=temperature
    )
```

**æ ¸å¿ƒåˆ†ææ–¹æ³•**ï¼š
```python
def analyze_open_ended_responses(responses: List[str]) -> SurveyAnalysisReport:
    """
    Pipeline:
    1. é¢„å¤„ç†ï¼š_preprocess_responses()
       - å»é™¤ç©ºç™½
       - è¿‡æ»¤çŸ­å›ç­”ï¼ˆ<3å­—ç¬¦ï¼‰
       - å»é‡
    
    2. LLMåˆ†æï¼š_perform_qualitative_analysis()
       - æ„å»ºåˆ†æPrompt
       - è°ƒç”¨LLM
       - è§£æJSONå“åº”
       - éªŒè¯æ•°æ®æ¨¡å‹
    
    3. è¿”å›ï¼šSurveyAnalysisReportå¯¹è±¡
    """
```

**Promptå·¥ç¨‹**ï¼š
```python
prompt = f"""ä½ æ˜¯ä¸€åä¸“ä¸šçš„å®šæ€§åˆ†æä¸“å®¶...

ã€åˆ†æè¦æ±‚ã€‘
1. ä¸»é¢˜ç¼–ç ï¼šè¯†åˆ«3-8ä¸ªæ ¸å¿ƒä¸»é¢˜
2. æƒ…æ„Ÿåˆ¤æ–­ï¼špositive/negative/neutral
3. å¼•è¿°æå–ï¼šæ‰¾åˆ°ä»£è¡¨æ€§ç”¨æˆ·åŸè¯
4. é¢‘æ¬¡ä¼°ç®—ï¼š1-10ç›¸å¯¹é¢‘æ¬¡
5. ä¸»é¢˜æè¿°ï¼šç®€çŸ­è¯´æ˜

ã€ç”¨æˆ·åé¦ˆæ–‡æœ¬ã€‘ï¼ˆå…± {total_count} æ¡ï¼‰
{combined_text}

ã€è¾“å‡ºè¦æ±‚ã€‘
ä¸¥æ ¼JSONæ ¼å¼ï¼š
{{
    "summary": "æ€»ä½“æ‘˜è¦...",
    "themes": [
        {{
            "theme": "ä¸»é¢˜åç§°",
            "sentiment": "positive|negative|neutral",
            "quote": "ä»£è¡¨æ€§å¼•è¿°",
            "count": 5,
            "description": "ä¸»é¢˜æè¿°"
        }}
    ],
    "recommendation": "è¡ŒåŠ¨å»ºè®®..."
}}
"""
```

**æŠ¥å‘Šç”Ÿæˆ**ï¼š
```python
def generate_report(report: SurveyAnalysisReport) -> str:
    """
    ç”ŸæˆMarkdownæ ¼å¼æŠ¥å‘Šï¼š
    # é—®å·å®šæ€§åˆ†ææŠ¥å‘Š
    ## æ€»ä½“æ‘˜è¦
    ## æ ¸å¿ƒä¸»é¢˜åˆ†æ
      ### âœ… ç§¯æåé¦ˆä¸»é¢˜
      ### âš ï¸ éœ€è¦å…³æ³¨çš„ä¸»é¢˜
      ### ğŸ“‹ ä¸­æ€§åé¦ˆä¸»é¢˜
    ## ğŸ’¡ è¡ŒåŠ¨å»ºè®®
    """
```

### 3. AnalysisToolkitï¼ˆåˆ†æå·¥å…·åŒ…ï¼‰

**ä½ç½®**ï¼š`app/utils/analysis_toolkit.py`

**èŒè´£**ï¼šæä¾›å„ç§åˆ†æå·¥å…·ï¼ˆå½“å‰æœªä½¿ç”¨ï¼Œä½†ä¿ç•™ç”¨äºæ‰©å±•ï¼‰

**å¯ç”¨å·¥å…·**ï¼š

1. **ç”¨æˆ·èšç±»** `tool_cluster_users()`
   - ç®—æ³•ï¼šKMeans
   - è¾“å…¥ï¼šé‡è¡¨é¢˜æ•°æ®
   - è¾“å‡ºï¼šç”¨æˆ·ç¾¤ä½“ç‰¹å¾

2. **ä¸»é¢˜æå–** `tool_extract_themes()`
   - ç®—æ³•ï¼šLDAï¼ˆæ½œåœ¨ç‹„åˆ©å…‹é›·åˆ†é…ï¼‰
   - è¾“å…¥ï¼šæ–‡æœ¬å›ç­”
   - è¾“å‡ºï¼šä¸»é¢˜å…³é”®è¯

3. **æƒ…æ„Ÿåˆ†æ** `tool_analyze_sentiment()`
   - ç®—æ³•ï¼šå…³é”®è¯åŒ¹é…
   - è¾“å…¥ï¼šæ–‡æœ¬å›ç­”
   - è¾“å‡ºï¼šæƒ…æ„Ÿåˆ†å¸ƒæ¯”ä¾‹

4. **å…³é”®è¯æå–** `tool_extract_keywords()`
   - ç®—æ³•ï¼šTF-IDF + è¯é¢‘ç»Ÿè®¡
   - è¾“å…¥ï¼šæ–‡æœ¬å›ç­”
   - è¾“å‡ºï¼šé«˜é¢‘å…³é”®è¯

5. **ç»Ÿè®¡æ‘˜è¦** `tool_statistics_summary()`
   - ç®—æ³•ï¼šæè¿°æ€§ç»Ÿè®¡
   - è¾“å…¥ï¼šé—®å·å’Œå›ç­”
   - è¾“å‡ºï¼šåŸºç¡€ç»Ÿè®¡ä¿¡æ¯

### 4. æ•°æ®æ¨¡å‹

**ä½ç½®**ï¼š`app/models/analysis_models.py`

**Pydanticæ¨¡å‹**ï¼š

```python
class Sentiment(str, Enum):
    """æƒ…æ„Ÿå€¾å‘æšä¸¾"""
    POSITIVE = "positive"
    NEGATIVE = "negative"
    NEUTRAL = "neutral"

class Theme(BaseModel):
    """ä¸»é¢˜ç¼–ç æ¨¡å‹"""
    theme: str              # ä¸»é¢˜åç§°
    sentiment: Sentiment    # æƒ…æ„Ÿå€¾å‘
    quote: str             # ä»£è¡¨æ€§å¼•è¿°
    count: int             # æåŠé¢‘æ¬¡
    description: Optional[str]  # ä¸»é¢˜æè¿°

class SurveyAnalysisReport(BaseModel):
    """é—®å·å®šæ€§åˆ†ææŠ¥å‘Š"""
    summary: str           # æ€»ä½“æ‘˜è¦
    themes: List[Theme]    # ä¸»é¢˜åˆ—è¡¨
    recommendation: str    # è¡ŒåŠ¨å»ºè®®
```

**ä½œç”¨**ï¼š
- âœ… ç±»å‹å®‰å…¨
- âœ… æ•°æ®éªŒè¯
- âœ… è‡ªåŠ¨æ–‡æ¡£
- âœ… JSONåºåˆ—åŒ–

---

## æ•°æ®æµç¨‹

### ğŸ“Š å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ç‚¹å‡»    â”‚
â”‚  "åˆ†æ"æŒ‰é’®  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯å‘èµ·è¯·æ±‚                            â”‚
â”‚  POST /api/analyze/{survey_id}          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPIè·¯ç”±å¤„ç†                         â”‚
â”‚  run_all.py#analyze_survey_results()    â”‚
â”‚  - æ¥æ”¶survey_id                        â”‚
â”‚  - åˆ›å»ºSurveyAnalysisEngine              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: æ•°æ®åŠ è½½                        â”‚
â”‚  SurveyAnalysisEngine._load_data()      â”‚
â”‚  - è¯»å–é—®å·æ¨¡æ¿JSON                      â”‚
â”‚  - è¯»å–æ‰€æœ‰å›ç­”JSON                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: æ•°æ®æå–                        â”‚
â”‚  _extract_open_ended_responses()        â”‚
â”‚  - è¯†åˆ«å¼€æ”¾é¢˜ID                          â”‚
â”‚  - ä»å›ç­”ä¸­æå–æ–‡æœ¬                      â”‚
â”‚  - è¿”å›çº¯æ–‡æœ¬åˆ—è¡¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: æ•°æ®é¢„å¤„ç†                      â”‚
â”‚  QualitativeAnalyzer._preprocess()      â”‚
â”‚  - å»é™¤ç©ºç™½                             â”‚
â”‚  - è¿‡æ»¤çŸ­æ–‡æœ¬                           â”‚
â”‚  - å»é‡                                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: æ„å»ºPrompt                     â”‚
â”‚  _perform_qualitative_analysis()        â”‚
â”‚  - åˆå¹¶æ‰€æœ‰æ–‡æœ¬                         â”‚
â”‚  - æ„å»ºåˆ†ææŒ‡ä»¤                         â”‚
â”‚  - æŒ‡å®šè¾“å‡ºæ ¼å¼                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: è°ƒç”¨LLM                        â”‚
â”‚  ChatDashScope.invoke()                 â”‚
â”‚  - å‘é€åˆ°é€šä¹‰åƒé—®API                    â”‚
â”‚  - ç­‰å¾…å“åº”ï¼ˆ15-30ç§’ï¼‰                  â”‚
â”‚  - æ¥æ”¶JSONå“åº”                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: è§£æå“åº”                        â”‚
â”‚  - æ¸…ç†Markdownæ ‡è®°                     â”‚
â”‚  - JSONè§£æ                             â”‚
â”‚  - Pydanticæ¨¡å‹éªŒè¯                     â”‚
â”‚  - åˆ›å»ºSurveyAnalysisReportå¯¹è±¡         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 7: ç”ŸæˆæŠ¥å‘Š                        â”‚
â”‚  generate_report()                      â”‚
â”‚  - è½¬æ¢ä¸ºMarkdownæ ¼å¼                    â”‚
â”‚  - æŒ‰æƒ…æ„Ÿåˆ†ç»„                           â”‚
â”‚  - æ·»åŠ æ—¶é—´æˆ³                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 8: ä¿å­˜ç»“æœ                        â”‚
â”‚  - ä¿å­˜åˆ°data/analyses/                 â”‚
â”‚  - æ–‡ä»¶åï¼šanalysis_{survey_id}.json    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 9: è¿”å›å“åº”                        â”‚
â”‚  - JSONæ ¼å¼                             â”‚
â”‚  - åŒ…å«ç»“æ„åŒ–æ•°æ®å’ŒMarkdownæŠ¥å‘Š          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯å±•ç¤º                                â”‚
â”‚  - è§£æJSON                             â”‚
â”‚  - æ¸²æŸ“Markdown                         â”‚
â”‚  - å±•ç¤ºä¸»é¢˜å’Œå»ºè®®                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”§ æ•°æ®è½¬æ¢ç¤ºä¾‹

**åŸå§‹å›ç­”æ•°æ®**ï¼š
```json
{
  "survey_id": "83f37184",
  "answers": {
    "1": "åšç¾çŠ¬",
    "5": "å®ƒçš„æ€§æ ¼å¾ˆæ¸©é¡ºï¼Œå¾ˆå–œæ¬¢å’Œäººäº’åŠ¨ï¼Œè€Œä¸”å¾ˆèªæ˜"
  }
}
```

**æå–åçš„æ–‡æœ¬**ï¼š
```python
[
  "å®ƒçš„æ€§æ ¼å¾ˆæ¸©é¡ºï¼Œå¾ˆå–œæ¬¢å’Œäººäº’åŠ¨ï¼Œè€Œä¸”å¾ˆèªæ˜",
  "åšç¾çŠ¬å¾ˆæ´»æ³¼ï¼Œéœ€è¦ç»å¸¸é›å¼¯",
  "æ¯›å‘éœ€è¦å®šæœŸæ‰“ç†ï¼Œæœ‰ç‚¹éº»çƒ¦"
  # ... æ›´å¤šæ–‡æœ¬
]
```

**LLMè¿”å›çš„JSON**ï¼š
```json
{
  "summary": "ç”¨æˆ·å¯¹åšç¾çŠ¬æ•´ä½“è¯„ä»·ç§¯æï¼Œè®¤ä¸ºæ€§æ ¼æ¸©é¡ºã€èªæ˜æ´»æ³¼ï¼Œä½†ä¹Ÿæåˆ°äº†æ¯›å‘æ‰“ç†å’Œè¿åŠ¨éœ€æ±‚æ–¹é¢çš„æŒ‘æˆ˜ã€‚",
  "themes": [
    {
      "theme": "æ€§æ ¼æ¸©é¡ºå‹å¥½",
      "sentiment": "positive",
      "quote": "å®ƒçš„æ€§æ ¼å¾ˆæ¸©é¡ºï¼Œå¾ˆå–œæ¬¢å’Œäººäº’åŠ¨",
      "count": 8,
      "description": "ç”¨æˆ·æ™®éè®¤ä¸ºåšç¾çŠ¬æ€§æ ¼å¥½ï¼Œé€‚åˆå®¶åº­é¥²å…»"
    },
    {
      "theme": "æ¯›å‘æ‰“ç†éº»çƒ¦",
      "sentiment": "negative",
      "quote": "æ¯›å‘éœ€è¦å®šæœŸæ‰“ç†ï¼Œæœ‰ç‚¹éº»çƒ¦",
      "count": 5,
      "description": "æ¯›å‘æŠ¤ç†æ˜¯ä¸»è¦çš„é¥²å…»æŒ‘æˆ˜"
    }
  ],
  "recommendation": "1. å¼ºè°ƒåšç¾çŠ¬æ€§æ ¼ä¼˜åŠ¿è¿›è¡Œæ¨å¹¿\n2. æä¾›æ¯›å‘æŠ¤ç†æŒ‡å—å’ŒæœåŠ¡\n3. å»ºè®®å‡†å¤‡å……è¶³çš„è¿åŠ¨æ—¶é—´"
}
```

**æœ€ç»ˆè¾“å‡º**ï¼š
```json
{
  "survey_id": "83f37184",
  "survey_title": "åšç¾çŠ¬é¥²å…»ä¹ æƒ¯ä¸åå¥½è°ƒæŸ¥é—®å·",
  "total_responses": 102,
  "open_ended_responses_count": 510,
  "status": "success",
  "report": {
    "summary": "...",
    "themes": [...],
    "recommendation": "..."
  },
  "formatted_report": "# MarkdownæŠ¥å‘Š..."
}
```

---

## ç®—æ³•æŠ€æœ¯

### 1. æ ¸å¿ƒæŠ€æœ¯ï¼šå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰

**ä½¿ç”¨çš„æ¨¡å‹**ï¼š
- **æä¾›å•†**ï¼šé˜¿é‡Œäº‘DashScope
- **æ¨¡å‹**ï¼šqwen-plusï¼ˆé€šä¹‰åƒé—®Plusï¼‰
- **å‚æ•°**ï¼š
  - Temperature: 0.7ï¼ˆå¹³è¡¡åˆ›é€ æ€§å’Œå‡†ç¡®æ€§ï¼‰
  - Max tokens: è‡ªåŠ¨ï¼ˆæ ¹æ®è¾“å…¥é•¿åº¦ï¼‰

**é€‰æ‹©ç†ç”±**ï¼š
1. âœ… **ä¸­æ–‡ç†è§£èƒ½åŠ›å¼º**ï¼šé’ˆå¯¹ä¸­æ–‡æ–‡æœ¬ä¼˜åŒ–
2. âœ… **ç»“æ„åŒ–è¾“å‡º**ï¼šå¯ä»¥æŒ‰JSONæ ¼å¼è¾“å‡º
3. âœ… **ä¸Šä¸‹æ–‡ç†è§£**ï¼šèƒ½ç†è§£å¤æ‚çš„åˆ†æä»»åŠ¡
4. âœ… **æˆæœ¬æ•ˆç›Š**ï¼šæ¯”GPT-4æ›´ç»æµ

**Promptå·¥ç¨‹æŠ€å·§**ï¼š
1. **è§’è‰²è®¾å®š**ï¼š"ä½ æ˜¯ä¸€åä¸“ä¸šçš„å®šæ€§åˆ†æä¸“å®¶"
2. **ä»»åŠ¡åˆ†è§£**ï¼šæ˜ç¡®åˆ—å‡º5ä¸ªå­ä»»åŠ¡
3. **æ ¼å¼çº¦æŸ**ï¼šä¸¥æ ¼æŒ‡å®šJSONæ ¼å¼
4. **ç¤ºä¾‹å¼•å¯¼**ï¼šæä¾›è¾“å‡ºæ ¼å¼ç¤ºä¾‹
5. **éªŒè¯è¦æ±‚**ï¼šå¼ºè°ƒæ•°æ®å‡†ç¡®æ€§

### 2. è¾…åŠ©æŠ€æœ¯æ ˆï¼ˆAnalysisToolkitä¸­ï¼‰

#### KMeansèšç±»
**ç®—æ³•**ï¼šK-Means Clustering
**åº“**ï¼šscikit-learn
**ç”¨é€”**ï¼šç”¨æˆ·åˆ†ç¾¤

```python
from sklearn.cluster import KMeans

# å¯¹é‡è¡¨é¢˜æ•°æ®è¿›è¡Œèšç±»
kmeans = KMeans(n_clusters=3, random_state=42, n_init=10)
cluster_labels = kmeans.fit_predict(data_matrix)
```

**åº”ç”¨åœºæ™¯**ï¼š
- è¯†åˆ«ä¸åŒæ»¡æ„åº¦ç¾¤ä½“
- å‘ç°ç”¨æˆ·ç±»å‹
- åˆ†ç¾¤ç»Ÿè®¡åˆ†æ

#### LDAä¸»é¢˜å»ºæ¨¡
**ç®—æ³•**ï¼šLatent Dirichlet Allocation
**åº“**ï¼šscikit-learn
**ç”¨é€”**ï¼šæ— ç›‘ç£ä¸»é¢˜æå–

```python
from sklearn.decomposition import LatentDirichletAllocation

# LDAä¸»é¢˜å»ºæ¨¡
lda = LatentDirichletAllocation(n_components=5, random_state=42)
lda.fit(tfidf_matrix)
```

**åº”ç”¨åœºæ™¯**ï¼š
- è‡ªåŠ¨å‘ç°æ–‡æœ¬ä¸»é¢˜
- ä¸»é¢˜åˆ†å¸ƒåˆ†æ
- å…³é”®è¯æå–

#### TF-IDF
**ç®—æ³•**ï¼šTerm Frequency-Inverse Document Frequency
**åº“**ï¼šscikit-learn
**ç”¨é€”**ï¼šæ–‡æœ¬å‘é‡åŒ–

```python
from sklearn.feature_extraction.text import TfidfVectorizer

vectorizer = TfidfVectorizer(max_features=500, min_df=1)
tfidf_matrix = vectorizer.fit_transform(texts)
```

**åº”ç”¨åœºæ™¯**ï¼š
- æå–é‡è¦è¯æ±‡
- æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—
- ç‰¹å¾å·¥ç¨‹

#### ä¸­æ–‡åˆ†è¯
**åº“**ï¼šjiebaï¼ˆç»“å·´åˆ†è¯ï¼‰
**ç”¨é€”**ï¼šä¸­æ–‡æ–‡æœ¬é¢„å¤„ç†

```python
import jieba

words = jieba.lcut("è¿™æ˜¯ä¸€æ®µä¸­æ–‡æ–‡æœ¬")
# ['è¿™æ˜¯', 'ä¸€æ®µ', 'ä¸­æ–‡', 'æ–‡æœ¬']
```

**åº”ç”¨åœºæ™¯**ï¼š
- åˆ†è¯
- å…³é”®è¯æå–
- åœç”¨è¯è¿‡æ»¤

### 3. æ•°æ®éªŒè¯æŠ€æœ¯

#### Pydantic
**åº“**ï¼šPydantic v2
**ç”¨é€”**ï¼šæ•°æ®æ¨¡å‹å’ŒéªŒè¯

```python
from pydantic import BaseModel, Field

class Theme(BaseModel):
    theme: str = Field(..., description="ä¸»é¢˜åç§°")
    sentiment: Sentiment = Field(..., description="æƒ…æ„Ÿå€¾å‘")
    count: int = Field(..., ge=0, description="æåŠé¢‘æ¬¡")
```

**åŠŸèƒ½**ï¼š
- âœ… ç±»å‹æ£€æŸ¥
- âœ… æ•°æ®éªŒè¯
- âœ… JSONåºåˆ—åŒ–
- âœ… è‡ªåŠ¨æ–‡æ¡£

---

## APIæ¥å£

### 1. åˆ†ææ¥å£

**ç«¯ç‚¹**ï¼š`POST /api/analyze/{survey_id}`

**è¯·æ±‚**ï¼š
```http
POST /api/analyze/83f37184 HTTP/1.1
Host: localhost:8002
Content-Type: application/json
```

**å“åº”**ï¼ˆæˆåŠŸï¼‰ï¼š
```json
{
  "success": true,
  "survey_id": "83f37184",
  "survey_title": "åšç¾çŠ¬é¥²å…»ä¹ æƒ¯ä¸åå¥½è°ƒæŸ¥é—®å·",
  "total_responses": 102,
  "open_ended_responses_count": 510,
  "analysis_type": "å®šæ€§åˆ†æ",
  "status": "success",
  "report": {
    "summary": "ç”¨æˆ·å¯¹åšç¾çŠ¬æ•´ä½“è¯„ä»·ç§¯æ...",
    "themes": [
      {
        "theme": "æ€§æ ¼æ¸©é¡ºå‹å¥½",
        "sentiment": "positive",
        "quote": "å®ƒçš„æ€§æ ¼å¾ˆæ¸©é¡ºï¼Œå¾ˆå–œæ¬¢å’Œäººäº’åŠ¨",
        "count": 8,
        "description": "ç”¨æˆ·æ™®éè®¤ä¸ºåšç¾çŠ¬æ€§æ ¼å¥½"
      }
    ],
    "recommendation": "1. å¼ºè°ƒåšç¾çŠ¬æ€§æ ¼ä¼˜åŠ¿..."
  },
  "formatted_report": "# é—®å·å®šæ€§åˆ†ææŠ¥å‘Š\n\n## ğŸ“Š æ€»ä½“æ‘˜è¦\n..."
}
```

**å“åº”**ï¼ˆæ— å¼€æ”¾é¢˜ï¼‰ï¼š
```json
{
  "success": true,
  "survey_id": "83f37184",
  "survey_title": "...",
  "total_responses": 50,
  "analysis_type": "å®šæ€§åˆ†æ",
  "status": "no_open_ended_questions",
  "message": "é—®å·ä¸­æ²¡æœ‰å¼€æ”¾é¢˜ï¼Œæ— æ³•è¿›è¡Œå®šæ€§åˆ†æ",
  "report": null
}
```

**å“åº”**ï¼ˆé”™è¯¯ï¼‰ï¼š
```json
{
  "success": false,
  "survey_id": "83f37184",
  "status": "error",
  "message": "æ‰¾ä¸åˆ°é—®å· 83f37184",
  "report": null
}
```

### 2. åˆ†æé¡µé¢

**ç«¯ç‚¹**ï¼š`GET /survey/{survey_id}?action=analyze`

**åŠŸèƒ½**ï¼š
- å±•ç¤ºåˆ†æç•Œé¢
- æä¾›"å¼€å§‹åˆ†æ"æŒ‰é’®
- å®æ—¶æ˜¾ç¤ºåˆ†æè¿›åº¦
- æ¸²æŸ“åˆ†æç»“æœ

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå®Œæ•´åˆ†ææµç¨‹

```python
# 1. åˆå§‹åŒ–åˆ†æå¼•æ“
from app.services.analysis_engine import SurveyAnalysisEngine

analyzer = SurveyAnalysisEngine(
    llm_model="qwen-plus",
    temperature=0.7
)

# 2. æ‰§è¡Œåˆ†æ
result = analyzer.analyze(survey_id="83f37184")

# 3. æ£€æŸ¥çŠ¶æ€
if result["status"] == "success":
    report = result["report"]
    print(f"è¯†åˆ«ä¸»é¢˜æ•°ï¼š{len(report['themes'])}")
    print(f"æ€»ä½“æ‘˜è¦ï¼š{report['summary']}")
    
    # 4. æŒ‰æƒ…æ„Ÿåˆ†ç»„
    for theme in report["themes"]:
        print(f"{theme['theme']} - {theme['sentiment']}")
else:
    print(f"åˆ†æå¤±è´¥ï¼š{result['message']}")
```

### ç¤ºä¾‹2ï¼šç›´æ¥ä½¿ç”¨å®šæ€§åˆ†æå™¨

```python
from app.services.qualitative_analyzer import QualitativeAnalyzer

# 1. åˆå§‹åŒ–
analyzer = QualitativeAnalyzer(llm_model="qwen-plus")

# 2. å‡†å¤‡æ•°æ®
responses = [
    "äº§å“è´¨é‡å¾ˆå¥½ï¼Œéå¸¸æ»¡æ„",
    "ä»·æ ¼æœ‰ç‚¹è´µï¼Œä½†ç‰©æœ‰æ‰€å€¼",
    "é…é€é€Ÿåº¦å¿«ï¼ŒåŒ…è£…ä¹Ÿå¾ˆå¥½"
]

# 3. æ‰§è¡Œåˆ†æ
report = analyzer.analyze_open_ended_responses(responses)

# 4. ç”ŸæˆMarkdownæŠ¥å‘Š
markdown_report = analyzer.generate_report(report)
print(markdown_report)
```

### ç¤ºä¾‹3ï¼šä½¿ç”¨åˆ†æå·¥å…·åŒ…

```python
from app.utils.analysis_toolkit import AnalysisToolkit

toolkit = AnalysisToolkit()

# 1. å…³é”®è¯æå–
keywords_result = toolkit.tool_extract_keywords(responses, top_k=10)
print(keywords_result["summary"])

# 2. æƒ…æ„Ÿåˆ†æ
sentiment_result = toolkit.tool_analyze_sentiment(responses)
print(f"ç§¯æ: {sentiment_result['positive_percentage']}%")

# 3. ç»Ÿè®¡æ‘˜è¦
stats = toolkit.tool_statistics_summary(survey, responses)
print(stats["summary"])
```

---

## æ‰©å±•æ€§è®¾è®¡

### ğŸ”§ å½“å‰æ¶æ„çš„æ‰©å±•ç‚¹

#### 1. æ·»åŠ æ–°çš„åˆ†ææ–¹æ³•
```python
class QualitativeAnalyzer:
    def analyze_by_aspect(self, responses, aspects):
        """æŒ‰é¢„å®šä¹‰æ–¹é¢è¿›è¡Œåˆ†æ"""
        pass
    
    def compare_groups(self, group1, group2):
        """å¯¹æ¯”ä¸åŒç¾¤ä½“çš„å›ç­”"""
        pass
```

#### 2. æ”¯æŒå¤šç§LLM
```python
class LLMFactory:
    @staticmethod
    def create_llm(provider, model):
        if provider == "dashscope":
            return ChatDashScope(model=model)
        elif provider == "openai":
            return ChatOpenAI(model=model)
        elif provider == "anthropic":
            return ChatAnthropic(model=model)
```

#### 3. æ·»åŠ ç¼“å­˜æœºåˆ¶
```python
class CachedAnalyzer:
    def __init__(self, cache_dir="data/analysis_cache"):
        self.cache_dir = cache_dir
    
    def analyze_with_cache(self, survey_id):
        # æ£€æŸ¥ç¼“å­˜
        cache_file = f"{self.cache_dir}/{survey_id}.json"
        if os.path.exists(cache_file):
            return load_cache(cache_file)
        
        # æ‰§è¡Œåˆ†æ
        result = self.analyzer.analyze(survey_id)
        
        # ä¿å­˜ç¼“å­˜
        save_cache(cache_file, result)
        return result
```

#### 4. æ”¯æŒæ‰¹é‡åˆ†æ
```python
class BatchAnalyzer:
    def analyze_multiple(self, survey_ids):
        """æ‰¹é‡åˆ†æå¤šä¸ªé—®å·"""
        results = {}
        for survey_id in survey_ids:
            results[survey_id] = self.analyze(survey_id)
        return results
    
    def compare_surveys(self, survey_ids):
        """å¯¹æ¯”å¤šä¸ªé—®å·çš„åˆ†æç»“æœ"""
        pass
```

#### 5. å®æ—¶åˆ†æ
```python
async def analyze_streaming(survey_id):
    """æµå¼è¿”å›åˆ†æç»“æœ"""
    async for chunk in llm.astream(prompt):
        yield {
            "type": "progress",
            "content": chunk
        }
```

### ğŸ¯ æœªæ¥æ”¹è¿›æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ Redisç¼“å­˜
   - å¼‚æ­¥åˆ†æä»»åŠ¡
   - ç»“æœé¢„è®¡ç®—

2. **åŠŸèƒ½å¢å¼º**
   - å¤šç»´åº¦åˆ†æ
   - æ—¶é—´åºåˆ—åˆ†æ
   - å¯¹æ¯”åˆ†æ

3. **å¯è§†åŒ–**
   - è¯äº‘å›¾
   - æƒ…æ„Ÿè¶‹åŠ¿å›¾
   - ä¸»é¢˜åˆ†å¸ƒå›¾

4. **å¯¼å‡ºåŠŸèƒ½**
   - PDFæŠ¥å‘Š
   - Excelæ•°æ®
   - PPTæ¼”ç¤º

---

## æ€»ç»“

### âœ… å½“å‰å®ç°çš„æ ¸å¿ƒä¼˜åŠ¿

1. **LLMé©±åŠ¨**ï¼šåˆ©ç”¨å¤§è¯­è¨€æ¨¡å‹çš„å¼ºå¤§ç†è§£èƒ½åŠ›
2. **ç»“æ„åŒ–è¾“å‡º**ï¼šPydanticæ¨¡å‹ç¡®ä¿æ•°æ®è´¨é‡
3. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„ç»„ä»¶èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
4. **å¯æ‰©å±•æ¶æ„**ï¼šé¢„ç•™äº†å¤šç§æ‰©å±•ç‚¹
5. **ç”¨æˆ·å‹å¥½**ï¼šMarkdownæŠ¥å‘Šæ˜“è¯»æ˜“æ‡‚

### ğŸ¯ æŠ€æœ¯æ ˆæ€»è§ˆ

- **æ ¸å¿ƒ**ï¼šLangChain + DashScope LLM
- **æ•°æ®éªŒè¯**ï¼šPydantic
- **è¾…åŠ©åˆ†æ**ï¼šscikit-learn, jieba
- **Webæ¡†æ¶**ï¼šFastAPI
- **æ•°æ®å­˜å‚¨**ï¼šJSONæ–‡ä»¶

### ğŸ“Š åˆ†æèƒ½åŠ›

âœ… **å½“å‰æ”¯æŒ**ï¼š
- å¼€æ”¾é¢˜å®šæ€§åˆ†æ
- ä¸»é¢˜è¯†åˆ«
- æƒ…æ„Ÿåˆ†æ
- è¡ŒåŠ¨å»ºè®®ç”Ÿæˆ

ğŸ”œ **æœªæ¥è®¡åˆ’**ï¼š
- å®šé‡æ•°æ®èšç±»
- å¤šç»´åº¦å¯¹æ¯”åˆ†æ
- å®æ—¶åˆ†æ
- å¯è§†åŒ–æŠ¥è¡¨

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-10-30  
**ç»´æŠ¤è€…**ï¼šAI Survey Assistant Team

